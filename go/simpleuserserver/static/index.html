<!DOCTYPE html>
<html>
  <head><title>Generated by javascript</title></head>
  <script>
    // An empty string means the server that hosts this page.
    var ROOT_PATH = "";

    // Hacky way to escape html
    function escapeHtml(html){
      var text = document.createTextNode(html);
      var p = document.createElement('p');
      p.appendChild(text);
      return p.innerHTML;
    }

    function appendText(text) {
      var text = document.createTextNode(text);
      var p = document.createElement('p');
      p.appendChild(text);
      document.body.appendChild(p);
    }

    function appendHeader(text) {
      var text = document.createTextNode(text);
      var header = document.createElement('h1');
      header.appendChild(text);
      document.body.appendChild(header);
    }

    function writeUsers(users) {
      appendHeader("Users");
      for (var i = 0; i < users.length; i++) {
        appendText("User: " + users[i].name + " email: " + users[i].email)
      }
    }
    
    function createUser(evt, formObj) {
      evt.preventDefault();

      fetch(ROOT_PATH + '/api/users', {
          method: 'post',
          body: new FormData(formObj)
      })
        .then(response => {
          if (!response.ok) {
            throw response;
          }
          response.json();
        })
        .then(jsonData => {
            console.log(jsonData);
            location.reload();
          })
        .catch(err => {
          err.text()
            .then(text => {
              console.log("Error: " + text)
              document.getElementById("message").innerHTML = escapeHtml(text)
            });
          });
    }

    fetch(ROOT_PATH + '/api/users', {
        method: 'get'
    })
      .then(response => response.json())
      .then(jsonData => {
          console.log(jsonData);
          writeUsers(jsonData);
        })
      .catch(err => {
        console.log("Error: " + err)
        });
  </script>

  <body>
    <form id="create_user_form">
      <h1>Create a user</h1>
      <label for="name">
        Name:
      </label>
      <input id="name" name="name" />
      <label for="name">
        Email:
      </label>
      <input id="email" name="email" />

      <button onclick="createUser(event, document.getElementById('create_user_form'))" type="submit">
        Create
      </button>
    </form>
    <div id="message">
    </div>
  </body>
</html>
